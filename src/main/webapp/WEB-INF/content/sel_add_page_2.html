<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<title></title>
		<link rel="stylesheet" href="css/bootstrap.min.css">	
		<script src="js/jquery-3.1.0.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<title>商户入驻申请</title>
		<style>
			.navbar{
				background: #00CA79;
			}
			
			.navbar-header{
				color: #fff;
			}
			.fa{
				font-size:2.5rem;
				cursor: pointer;
			}
			.radiu-label{
				margin-right: 30px;
			}
			.center{
				display: block;
				margin: 0 auto;
			}
			.submit-btn{
				width:17rem;
				margin-top:8px;
				margin-bottom: 15px;
			}
			body{
				background: #EFEFEF;
			}
			.container{
				background: white;
			}
			
			 .content {
			 	padding-left: 15px;
			}
			
			.btn-hidden{
				visibility: hidden;
			}
			.pic-img{
				width:150px;
				height:125px;
				background:#EEE;
				color: black;
			}
			
			.pic-img > img{  
				color: #888;
				border-style: none;
				border-width:0;
			}
			
			#bus-lens-pic{
				display: none;
			}
			
			#other-lens-pic{
				display:none;
			}
			@media screen and (max-width:768px){
				.navbar{
					margin-right: -15px;
					margin-left: -15px;
				}
			}
		</style>
	</head>
	<body>
		<div class="container">
			<header>
				<nav class="navbar ">
					<div class="navbar-header">
						<div class="navbar-brand"><i id="back" class="glyphicon glyphicon-menu-left fa"></i></div>
					</div>			
				</nav>
			</header>
			<article class="content">
				<form role="form" class="form-horizontal">
					<div class="form-group" >
						<label for="store-address" class="control-label col-sm-2">店铺位置</label>
						<div class="col-sm-6" >
							<input class="form-control" id="store-address" disabled/>
						</div>
					</div>
					<div class="form-group" >
						<label for="store-address-detail" class="control-label col-sm-2">详细地址</label>
						<div class="col-sm-6" >
							<input class="form-control" id="store-address-detail"/>
						</div>
					</div>
					<div class="form-group" >
						<label for="store-name" class="control-label col-sm-2">商户名称</label>
						<div class="col-sm-6" >
							<input class="form-control" id="store-name"/>
						</div>
					</div>
					<div class="form-group" >
						<label  class="control-label col-sm-2">商户类型</label>
						<div class="radio col-sm-6">
							<label  class="radiu-label">
								<input type="radio" name="typeoptions"  value="企业商户">企业商户
							</label>
							<label  class="radiu-label">
								<input type="radio" name="typeoptions"  value="个体商户">个体商户
							</label>
					  	</div>
					</div>
					<div class="form-group" >
						<label  class="control-label col-sm-2">经营范围</label>
						<div class="radio col-sm-6" >
							<label class="radiu-label">
								<input type="radio" name="rangeoptions" value="月嫂">月嫂
							</label>
							<label class="radiu-label">
								<input type="radio" name="rangeoptions" value="保姆服务">保姆服务
							</label>
							<label class="radiu-label">
								<input type="radio" name="rangeoptions" value="日常保洁">日常保洁
							</label>
							<label class="radiu-label">
								<input type="radio" name="rangeoptions" value="新居开荒">新居开荒
							</label>
							<label class="radiu-label">
								<input type="radio" name="rangeoptions"  value="擦玻璃">擦玻璃
							</label>
							<label class="radiu-label">
								<input type="radio" name="rangeoptions"  value="家电清洗">家电清洗
							</label>
							<label class="radiu-label">
								<input type="radio" name="rangeoptions"  value="家电维修">家电维修
							</label>
							
					  </div>
					</div> 
					<div class="form-group" >
						<label for="link-name" class="control-label col-sm-2">联系人</label>
						<div class="col-sm-6" >
							<input class="form-control" id="link-name"/>
						</div>
					</div>
					<div class="form-group" >
						<label for="link-phone" class="control-label col-sm-2">联系电话</label>
						<div class="col-sm-6" >
							<input class="form-control" id="link-phone"/>
						</div>
					</div>
					<div class="form-group">
						<label  class="control-label col-sm-2">图片信息</label>
						<div class="col-sm-9" >
							<div class="col-xs-12 col-sm-5">
								<label>
									1.店铺门脸图
									<div class="pic-container">
										<div class="pic-img">
											<img width="150" height="125"  title="点击上传门脸图" src="img/addpic.png"/>
										</div>
										<div class="load-btn-block">
											<input id="main-pic-1" class="btn-hidden load-btn" type="file"  accept="image/gif,image/jpg,image/jpeg,image/png"  >
										</div>
									</div>
								</label>
							</div>
							<div class="col-xs-12 col-sm-5">
								<label>
									2.店内环境图
									<div class="pic-container">
										<div class="pic-img">
											<img width="150" height="125" title="点击上传环境图" src="img/addpic.png"/>
										</div>
										<div class="load-btn-block">
											<input  id="main-pic-2" class="btn-hidden load-btn" type="file" accept="image/gif,image/jpg,image/jpeg,image/png" >
										</div>
									</div>
								</label>
							</div>
						</div>
					</div>			
					<script type="text/javascript">
						var stg=window.sessionStorage;
						var province=stg.getItem('province'); 
						var city=stg.getItem('city');
						var region=stg.getItem('region');
						var street=stg.getItem('street');
						var mainPic1,mainPic2,sellPic,otherPic1,otherPic2,otherPic3;
						function readPic(fileElement){
							
							var file=fileElement.files[0];
							if(!/image\/\w+/.test(file.type)){
								alert("请确保文件为图像类型");
								return false;
							}
							var reader=new FileReader;
							reader.readAsDataURL(file);  
							reader.onload=function(e){
								$(fileElement).parent().parent().find('.pic-img img').attr('src',this.result);
								var elementId=$(fileElement).attr("id");
								switch(elementId){
									case 'main-pic-1':
										mainPic1=this.result;
										break;
									case 'main-pic-2':
										mainPic2=this.result;
										break;
									case 'sell-pic':
										sellPic=this.result;
										break;
									case 'other-pic-1':
										otherPic1=this.result;
										break;
									case 'other-pic-2':
										otherPic2=this.result;
										break;
									case 'other-pic-2':
										otherPic2=this.result;
										break;
								}
							}
						}
						
						function submit(){
							var errorState=false;
							var storeAddressDetail=$('#store-address-detail').val().trim();
							if(storeAddressDetail==null||storeAddressDetail==""){
								$('#store-address-detail').parent().addClass('has-error');
								errorState=true;
							}
							var storeName=$('#store-name').val().trim();
							if(storeName==null||storeName==""){
								$('#store-name').parent().addClass('has-error');
								errorState=true;
							}
							var storeType=$("input[name='typeoptions']:checked").val();
							if(storeType==null){
								$("input[name='typeoptions']").parent().parent().addClass('has-error');
								errorState=true;
							}
							var rangeType=$("input[name='rangeoptions']:checked").val();
							if(rangeType==null){
								$("input[name='rangeoptions']").parent().parent().addClass('has-error');
								errorState=true;
							}
							var linkName=$('#link-name').val().trim();
							if(linkName==null||linkName==""){
								$('#link-name').parent().addClass('has-error');
								errorState=true;
							}
							var linkPhone=$('#link-phone').val().trim();
							if(linkPhone==null||linkPhone==""){
								$('#link-phone').parent().addClass('has-error');
								errorState=true;
							}
							var caroption=$("input[name='caroptions']:checked").val();
							if(caroption==null){
								$("input[name='caroptions']").parent().parent().addClass('has-error');
								errorState=true;
							}
							var noPic=false;
							if(mainPic1==null){
								noPic=true;
								errorState=true;
							}
							if(mainPic2==null){
								noPic=true;
								errorState=true;
							}
							if(caroption=='营业执照'){
								if(sellPic==null){
									noPic=true;
									errorState=true;
								}
							}else if(caroption=='其他资质'){
								if(otherPic1==null&&otherPic2==null&&otherPic3==null){
									noPic=true;
									errorState=true;
								}
							}
							if(noPic){
								alert('请上传完整对应的照片');
							}
							if(errorState){
								return;
							}
							
							$.ajax({
								url:'commitApply.action',
								type:'post',
								data:{
									province:province,
									city:city,
									region:region,
									street:street,
									addressDetail:storeAddressDetail,
									storeName:storeName,
									storeType:storeType,
									rangeType:rangeType,
									linkName:linkName,
									linkPhone:linkPhone,
									mainPic1:mainPic1,
									mainPic2:mainPic2,
									carType:caroption,
									sellPic:sellPic,
									otherPic1:otherPic1,
									otherPic2:otherPic2,
									otherPic3:otherPic3
								},
								dataType:'json',
								success:function(msg){
									var data=eval(msg);
									var result=data['resultMap']['result'];
									if(result=='success'){
										location.href="toSelectAddressPage3";
									}
									
								},
								error:function(){
									alert('网络连接失败');
								}
							});
						}
						
						
						$(document).ready(function(){
							if(province!=null&&city!=null&&region!=null&street!=null)
								$('#store-address').val(""+province+city+region+street);
							$('.load-btn').change(function(){
								readPic($(this).get(0));
							});
							$('#back').click(function(){
								history.back(-1)
							});
							$("input").change(function(){
								$(this).parent().removeClass('has-error');
								$(this).parent().parent().removeClass('has-error');
							});
							$("[name='caroptions']").change(function(){
								var value=$(this).val();
								if(value==='营业执照'){
									$('#bus-lens-pic').show();
									$('#other-lens-pic').hide();
									
								}else if(value==='其他资质'){
									$('#bus-lens-pic').hide();
									$('#other-lens-pic').show();
								}else if(value==='无资质'){
									$('#bus-lens-pic').hide();
									$('#other-lens-pic').hide();
								}
							});
						});
					</script>
					<div class="form-group" >
						<label  class="control-label col-sm-2">资质信息</label>
						<div class="radio col-sm-6" >
							<label class="radiu-label">
								<input type="radio" name="caroptions"  value="营业执照">营业执照
							</label>
							<label class="radiu-label">
								<input type="radio" name="caroptions"  value="其他资质">其他资质
							</label>
							<label class="radiu-label">
								<input type="radio" name="caroptions"  value="无资质">无资质
							</label>
					  </div>		  	
					</div> 
					<div class="form-group">
						<div  id="bus-lens-pic">
						<label  class="control-label col-sm-2"></label>
						<div class="col-sm-9" >
							<div class="col-xs-12 col-sm-4">
								<label>
									<div class="pic-container">
										<div class="pic-img">
											<img width="150" height="125" title="点击上传营业执照图" src="img/addpic.png"/>
										</div>
										<div class="load-btn-block">
											<input id="sell-pic" class="btn-hidden load-btn" type="file" accept="image/gif,image/jpg,image/jpeg,image/png" >
										</div>
									</div>
								</label>
							</div>
				  		</div>
				  	</div>
				  	<div   id="other-lens-pic">
						<label  class="control-label col-sm-2"></label>
						<div class="col-sm-9" >
							<div class="col-xs-12 col-sm-4">
								<label>
									<div class="pic-container">
										<div class="pic-img">
											<img width="150" height="125" title="点击上传图一" src="img/addpic.png"/>
										</div>
										<div class="load-btn-block">
											<input id="other-pic-1" class="btn-hidden load-btn" type="file" accept="image/gif,image/jpg,image/jpeg,image/png" >
										</div>
									</div>
								</label>
							</div>
							<div class="col-xs-12 col-sm-4">
								<label>
									<div class="pic-container">
										<div class="pic-img">
											<img width="150" height="125" title="点击上传图二"  src="img/addpic.png"/>
										</div>
										<div class="load-btn-block">
											<input id="other-pic-2" class="btn-hidden load-btn" type="file"  accept="image/gif,image/jpg,image/jpeg,image/png">
										</div>
									</div>
								</label>
							</div>
							<div class="col-xs-12 col-sm-4">
								<label>
									<div class="pic-container">
										<div class="pic-img">
											<img width="150" height="125" title="点击上传图三" src="img/addpic.png" />
										</div>
										<div class="load-btn-block">
											<input id="other-pic-3" class="btn-hidden load-btn" type="file" accept="image/gif,image/jpg,image/jpeg,image/png">
										</div>
									</div>
								</label>
							</div>
						</div>
				  	</div>
					</div>
					
				</form>
				<div style="height: 18px;"></div>
			</article>
			
		</div> 
		<button  class="btn btn-info submit-btn  center" onclick="submit()">提交申请</button>
	</body>
</html>
